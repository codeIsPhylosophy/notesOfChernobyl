const ulList=document.querySelector(".blockList"),ulCollection=ulList.children,templateLi=document.querySelector("#createLi").content,toggleInput=document.querySelector(".toggle-all"),toggle=document.querySelector(".toggleLabel"),input=document.querySelector(".input_start"),clearCompleted=document.querySelector(".clearCompleted"),footer=document.querySelector(".footer"),counterItems=document.querySelector(".counterItems"),image=document.querySelector(".image"),headerImage=document.querySelector(".header__image"),headerTitle=document.querySelector(".superTitle");let count=0;const items=JSON.parse(localStorage.getItem("items"))||[];window.onload=()=>{deleteNote(),toggleColor(),makeDoneTrue(),visor(ulCollection),addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items))},input.addEventListener("keydown",(function(e){if("Enter"===e.key&&input.value.trim()){toggle.style.display="block",footer.style.display="flex";const e=templateLi.querySelector(".blockList__elem").cloneNode(!0).querySelector("p"),t=input.value;e.textContent=t,input.value="";const l={messageText:t,done:!1};items.push(l),editorFunction(),deleteNote(),addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items)),countItemsFunction(),makeDoneTrue(),visor(ulCollection)}}));const addToUlList=(e=[],t)=>{t.innerHTML=e.map(((e,t)=>`\n  <li class="blockList__elem">\n    <div class="check-wrapp">\n      <label>\n       <input class="origCheck" data-index = ${t} id= "item${t}" type="checkbox" ${e.done?"checked":""}/>\n        <div class="falseCheck"></div>\n     </label>\n    </div>\n    <div class="paragraph-wrap">\n      <p class = '${e.done?"selectP":""}'>${e.messageText}</p>\n      <input class="editorInput" type="text">\n      <button class="closeMe"></button>\n      <label for = "item${t}"></label>\n  </li>    \n    `)).join(""),editorFunction(),deleteNote(),toggleColorFragmentCode(),footerFocus(),selectAllMarker(),countItemsFunction(),fixInput(),viewClearCompleted()},deleteNote=()=>{const e=ulList.querySelectorAll(".blockList__elem");for(let t=0;t<e.length;t++){e[t].querySelector(".closeMe").addEventListener("click",(function(){items.splice(t,1),addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items)),visor(ulCollection),toggleColorFragmentCode(),countItemsFunction()}))}};function visor(e){0===e.length?(toggle.style.display="none",footer.style.display="none"):(toggle.style.display="block",footer.style.display="flex")}const viewClearCompleted=()=>{items.some((e=>e.done))?clearCompleted.style.display="block":clearCompleted.style.display="none"},selectAllMarker=()=>{toggle.addEventListener("click",(function(){const e=ulList.querySelectorAll(".origCheck");if(toggleInput.checked){for(const t of e)t.checked=!1;clearCompleted.style.display="none"}else{for(const t of e)t.checked=!0;clearCompleted.style.display="block"}}))},toggleColor=()=>{ulList.addEventListener("change",(function(){const e=ulList.querySelectorAll(".origCheck"),t=[];for(let l=0;l<e.length;l++)e[l].checked&&t.push(e[l]);t.length===e.length?toggleInput.checked=!0:toggleInput.checked=!1}))},toggleColorFragmentCode=()=>{const e=ulList.querySelectorAll(".origCheck"),t=[];for(let l=0;l<e.length;l++)e[l].checked&&t.push(e[l]);t.length===e.length?toggleInput.checked=!0:toggleInput.checked=!1},clearCompletedButton=()=>{clearCompleted.addEventListener("click",(function(){items.filter((e=>e.done)).forEach((e=>{const t=items.indexOf(e);items.splice(t,1)})),addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items)),clearCompleted.style.display="none",visor(ulCollection)}))},footerMenu=()=>{const e=document.querySelectorAll("ul.selectButtons li");for(let t of e)t.addEventListener("click",(function(e){e.target.classList.contains("activeBtn")?activeFunction():e.target.classList.contains("completedBtn")?completedFunction():e.target.classList.contains("allBtn")&&allFunction()}))},footerFocus=()=>{const e=document.querySelectorAll("ul.selectButtons li");for(const t of e)t.addEventListener("click",(()=>{document.querySelector("ul.selectButtons li.focus").classList.remove("focus"),t.classList.add("focus")}))},fixInput=()=>{const e=document.querySelectorAll("ul.selectButtons li");for(let t=0;t<e.length;t++)e[0].classList.contains("focus")?allFunction():e[1].classList.contains("focus")?activeFunction():e[2].classList.contains("focus")&&completedFunction()},completedFunction=()=>{const e=ulList.querySelectorAll(".origCheck"),t=ulList.querySelectorAll(".blockList__elem");for(let l=0;l<e.length;l++)e[l].checked?t[l].style.display="flex":t[l].style.display="none"},activeFunction=()=>{const e=ulList.querySelectorAll(".origCheck"),t=ulList.querySelectorAll(".blockList__elem");for(let l=0;l<e.length;l++)e[l].checked?t[l].style.display="none":t[l].style.display="flex"},allFunction=()=>{const e=ulList.querySelectorAll(".blockList__elem");for(let t=0;t<e.length;t++)e[t].style.display="flex"},countItemsFunction=()=>{const e=ulList.querySelectorAll(".blockList__elem .origCheck:not(:checked)").length,t=ulList.querySelectorAll(".origCheck"),l=[];for(let o=0;o<t.length;o++)t[o].checked||l.push(e[o]);const o=1===l.length?" item":" items";return counterItems.textContent=`${l.length} ${o} left`},editorFunction=()=>{const e=ulList.querySelectorAll(".blockList__elem");for(let t=0;t<e.length;t++)e[t].addEventListener("dblclick",(()=>{const l=e[t].querySelector(".editorInput"),o=e[t].querySelector("p");l.style.display="block";let s=!1;l.addEventListener("blur",(()=>{s&&(l.value.trim()?(items[t].messageText=l.value,addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items)),l.style.display="none"):(items.splice(t,1),addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items)),visor(ulCollection),countItemsFunction()))})),document.addEventListener("mousedown",(e=>{s=!e.target.classList.contains("editorInput")})),l.addEventListener("focus",(()=>{l.value=o.textContent.trim()})),l.addEventListener("keydown",(e=>{"Enter"===e.key?(s=!1,l.value.trim()?(l.style.display="none",items[t].messageText=l.value,addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items))):(items.splice(t,1),addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items)),visor(ulCollection),countItemsFunction())):"Escape"===e.key&&(s=!1,l.value.trim()?(items[t].messageText=l.value,addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items)),l.style.display="none"):(o.value=l.textContent,l.style.display="none",addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items))))})),l.focus()}))},easterEgg=()=>{headerImage.addEventListener("click",(function(){count+=1,26===count?(image.src="images/cat.jpg",headerTitle.textContent="THE EASTER CAT!",input.placeholder="Congratulations! You found the Easter cat!"):30===count&&dateDead()}))},dateDead=()=>{const e=document.querySelector(".input_start"),t=(new Date).getFullYear()-1986;"easter cat"===e.value&&(e.value="It's been "+t+" years")},makeDoneTrue=()=>{const e=document.querySelector(".toggle-all");e.addEventListener("click",(()=>{if(e.checked)for(let e=0;e<items.length;e++)items[e].done=!0;else for(let e=0;e<items.length;e++)items[e].done=!1;localStorage.setItem("items",JSON.stringify(items)),addToUlList(items,ulList)}))},toggleDone=e=>{if(!e.target.matches(".origCheck"))return;const t=e.target.dataset.index;items[t].done=!items[t].done,localStorage.setItem("items",JSON.stringify(items)),addToUlList(items,ulList)};ulList.addEventListener("click",toggleDone),editorFunction(),addToUlList(items,ulList),visor(ulCollection),clearCompleted.addEventListener("click",(function(){items.filter((e=>e.done)).forEach((e=>{const t=items.indexOf(e);items.splice(t,1)})),addToUlList(items,ulList),localStorage.setItem("items",JSON.stringify(items)),clearCompleted.style.display="none",visor(ulCollection)})),footerMenu(),headerImage.addEventListener("click",(function(){count+=1,26===count?(image.src="images/cat.jpg",headerTitle.textContent="THE EASTER CAT!",input.placeholder="Congratulations! You found the Easter cat!"):30===count&&dateDead()})),dateDead();